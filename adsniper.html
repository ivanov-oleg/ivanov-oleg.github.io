<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Тестовое задание AdSniper</title>
</head>

<body>
    <div id='root'> </div>
    <div id='etagcon'> </div>
    <script>
    /**
     * Функция, отрабатывающая при старте     
     */
    (function() {

        var url = 'https://trafsync.com/17/';

        /**
         * Функция, получающая идентификатор
         * @return {string} Наш идентификатор
         */
        function getEtagLocal() {
            return encodeURIComponent(window.localStorage['adsn.etag']);
        }

        /**
         * Функция, записывающая идентификатор в localStorage
         * @return {string} Наш идентификатор
         */
        function setEtagLocal(etag) {
            window.localStorage['adsn.etag'] = etag;
        }

        var fr = document.createElement('iframe'),
            root = document.getElementById('root'),
            etagcon = document.getElementById('etagcon'),
            etag = getEtagLocal(),
            xmlhttp;

        fr.width = 300;
        fr.height = 400;

        if (etag == 'undefined' || etag == null) {
            xmlhttp = new XMLHttpRequest;
            xmlhttp.open('GET', url, true);
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4) {
                    if (xmlhttp.status == 200) {
                        etag = xmlhttp.getResponseHeader('ETag');
                        fr.src = url + '?etag=' + etag;
                        setEtagLocal(etag);
                        etagcon.innerText = etag;
                    }
                }
            };
            xmlhttp.send(null);
        } else {
            fr.src = url + '?etag=' + etag;
        }

        etagcon.innerText = etag;
        root.appendChild(fr);
    })();
    </script>
</body>

</html>
